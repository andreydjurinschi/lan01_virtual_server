# Лабораторная работа №1. Виртуальный сервер

### Выполнил Джуринский Андрей. Студент группы I2302
### Дата выполнения 15.02.2025
## Цель работы

Познакомится с основами виртуализации, установкой и настройкой виртуального сервера на базе ос Debian, при помощи инструмента виртуализации **QEMU**

## Процесс выполнения работы
### 1. **Подготовка**

Для представления unix-подобного терминала уставливаю [msys32](https://www.msys2.org/).
Далее необходимо установить гипервизор **QEMU**, который позволяет запускать виртуальные машины на базе различных операционных систем.
Команда: ```pacman -S mingw-w64-ucrt-x86_64-qemu``` состоит из `pacman` - пакетного менеджера, `-S` - указания на установку пакета и `mingw-w64-ucrt-x86_64-qemu` названия самого пакета
![Qemu install](https://i.imgur.com/7tESihK.png)
 
Затем при помощи wget утилиты загружаю установочный образ ОС Debian 

![Debian install](https://i.imgur.com/Dn1UhuA.png)

> **Вопрос 1:** Каким образом можно скачать файл в консоли при помощи утилиты wget?

**При помощи утилиты wget и вставки URL адреса файла мы можем установить его в текущую директорию, Пример:** ``wget https://cdimage.debian.org/debian-cd/current/amd64/iso-dvd/debian-12.9.0-amd64-DVD-1.iso``
### 2. **Выполнение**

Создаю папку `lab01`, в ней  папку `dvd` и `readme.md` файл.
![Desc](https://i.imgur.com/mtt8ZpQ.png)
![Desc readme](https://i.imgur.com/CHCTb7a.png)
В папку dvd при помощи утилиты `mv` помещаю образ дистрибутива и при помощи той же утилиты переименовываю его:
![move debian ISO file](https://i.imgur.com/4t6iVQr.png)
далее по заданию создаем образ диска для ВМ размером **8 гб** и с форматом `qcow2`, при помощи команды `qemu-img create -f qcow2 debian.qcow2 8G`. 
`qemu-img` - утилита для работы с образами диском, `create -f qcow2` - команда для создания нового диска с заданным форматом, позволяющим увеличивать размера файла по мере его использования, `debian.qcow2` - название файла и `8G` - его размер

> **Вопрос 6:** Сколько места занимает установленная вами ОС (виртуальный диск) на хостовой машине?

**Установленая ОС занимает 8 ГБ места, однако фактический размер будет намного меньше до того момента, пока я не начну далее устанавливать доп пакеты для выполнения лаб работы, в этом и прелесть формата qcow2, тк он позволяет динамически выделять место для виртуального диска и увеличивать его по мере работы**

#### Далее подробно поговорим о процессе установки ОС Debian на виртуальную машину:
Команда `qemu-system-x86_64 -hda debian.qcow2 -cdrom dvd/debian.iso -boot d -m 2G`

`-hda debian.qcow2` указывает на использование образа диска в качестве основного для виртуальной машины

`-cdrom dvd/debian.iso` - указывает на ISO образ диска ОС, который будет смонтирован в качестве устройства виртуальной машины

`boot d` - указывает, что виртуальная машина должна загрузиться с диска описанного выше и будет использоваться как основное устройство для загрузки

параметры при установки указывались из материалов лаб работы 
![Downloading](https://i.imgur.com/tummHXQ.png)

Процесс установки занимал приличное врем, переодически выдавая всплывающие окна, например:
![label1](https://i.imgur.com/OWvglVA.png)
здесь инсталлятор запрашивал провести сканирования на наличие доп источников, которые могу содержать доп пакеты, однако образ у меня только один, соответственно пропускаем данный шаг

![label2](https://i.imgur.com/j5w3TgR.png)
На данном этапе установщик запросил использовать сетевое зеркало для установки доп пакетов, которые отсутствуют на моем ISO образе, с данным шагом я уже согласился, тк не хотел рисковать

После завершения загрузки исполняем команду из отчета по лабораторной работе

`qemu-system-x86_64 -hda debian.qcow2 -m 2G -smp 2 \ -device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp::1080-:80,hostfwd=tcp::1022-:22`

команда позволяет запустить эмулятор qemu указывая на наш виртуальный диск, так же задает важные параметры по типу добавления виртуального интерыейса `-device e1000,netdev=net0`, `hostfwd=tcp::1080-:80` для получения доступа к виртуальному серверу с хоста (apache в нашем случае)

![waiting](https://i.imgur.com/d0sYMTU.png)

после выполнения команды ждем прогрузку qemu,
на данном этапе мы подключаемся к виртуальной машине **qemu** с доступом в ос **debian**. Аосле запуска входим в систему с заданными паролем и юзернеймом и подключаемся сразу к root пользователю. Тк при установке debian я пропустил этап создания пароля для рут пользователя, пароль остается таким же как и у созданного user:
![vhod](https://i.imgur.com/lLxiyXK.png)

Далее устанавливаю необходимые пакеты:

`apt update -y` 

`apt install -y apache2 php libapache2-mod-php php-mysql mariadb-server mariadb-client unzip`

> Какое назначение установленных пакетов?

`apache2` - сервер для размещения веб сайтов, обслуживая http запросы и предоставляя ответы

`php` - ЯП, предназначенный для выполнения и создания серверной логики веб приложений

`libapache2-mod-php` - библиотека, позволяющая `apache` обрабатывать пхп скрипты

`php-mysql` - библиотека, позволяющая работать  php с mysql

`mariadb-server` - СУБД для хранения и управления базой данных

`mariadb-client` - пакет, необходимый для работы с mariadb через командную строку

`unzip` - пакет, используемый для распаковки файлов

![Downloading](https://i.imgur.com/0G2aoKs.png)

Далее устанавливаем Субд `phpmyadmin` при помощи `wget`, а так же `drupal`, благодаря той же утилиты:

![phpmyadmin](https://i.imgur.com/CFLg1bC.png)

![drupal](https://i.imgur.com/cgkgtsp.png)

**phpMyAdmin** - представляет собой веб интерфейс для работы с базами данных.

**Drupal** - инструмент для управления контентом на веб сайтах

После установки проверяем наличие файлов:

![CheckingFiles](https://i.imgur.com/fSQYy05.png)

`ls -l` - показывает расположение файлов в текущем дериктории с правами доступа, владельцем, размером, дате изменения

Затем выполняем следующие команды:

`mkdir /var/www` - создаем директорию

`unzip phpMyAdmin-5.2.2-all-languages.zip` - распаковываем архив

`mv phpMyAdmin-5.2.2-all-languages /var/www/phpmyadmin` - перемещаем в указанный путь разархированный файл 

`unzip drupal-10.0.5.zip` - распаковываем

`mv drupal-10.0.5 /var/www/drupal` - перемещаем

проверяем:
![CheckingFilesDrupal&phpMyAmin](https://i.imgur.com/RCPKS2Z.png)

Далее по плану - входим в MySql под именем root

![SQL](https://i.imgur.com/cQQJj3T.png)

данный скрипт создает БД и пользователя:
`CREATE DATABASE drupal_db;` - создаем БД

`CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';` - создаем нового пользователя с паролем

`GRANT ALL PRIVILEGES ON drupal_db.* TO 'user'@'localhost';` - передаем пользователю все права над БД `drupal_db`

`FLUSH PRIVILEGES;` - сохраняем привилегии

`EXIT;` - выходим

переходим к созданию конфигурационных файлов, которые нужны для определения, как наш сервер будет обрабатывать запросы к определнным веб сайтам

`nano /etc/apache2/sites-available/01-phpmyadmin.conf` - пример создания конфигурационного файла для доступа к `phpMyAdmin`
Содержимое файла:
```
<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot "/var/www/phpmyadmin"
    ServerName phpmyadmin.localhost
    ServerAlias www.phpmyadmin.localhost
    ErrorLog "/var/log/apache2/phpmyadmin.localhost-error.log"
    CustomLog "/var/log/apache2/phpmyadmin.localhost-access.log" common
</VirtualHost>
```
`VirtualHost` - хост, принимающий запросы на 80 порт
`DocumentRoot` - корневая папка, где находится `phpMyAdmin`
`ServerName` - доменное имя сайта
`ServerAlias` - доп имя также доступная для перехода на сайт
`ErrorLog` - логи по которым можно будет записывать и узнавать информацию о каких-либо ошибках

![phpCongFIle](https://i.imgur.com/psl2FOz.png)

Аналогичную работу проворячиваем и с `drupal`, создаем сам файл и делаем все записи:

![drupalConfFile](https://i.imgur.com/uiTtG5D.png)

созданные файлы конфигурации регистрируем
```
/usr/sbin/a2ensite 01-phpmyadmin
/usr/sbin/a2ensite 02-drupal
```

![RegisterConf](https://i.imgur.com/COMOpP4.png)

`systemctl reload apache2` - перезапускаем apache

Добавляем в файл /etc/hosts строки:

```
127.0.0.1 phpmyadmin.localhost
127.0.0.1 drupal.localhost
```
![](https://i.imgur.com/L9kpI1Q.png)

Этот шаг нужен для того, чтобы запрос обращался к локальному серверу на моем ноутбуке

> Что выводится на экране в результате выполнения данной команды (uname -a)?

**uname -a** - выводит информацию о линукс системе (имя хоста, операционной системы, номере сборки самого ядра)

![uname -a](https://i.imgur.com/oZra01R.png)

> Как перегрузить Apache Web Server?

**при помощи systemctl restart или systemctl reload**

Мы на финишной прямой, соталось только проверить доступность каждого из веб сайтов:

Завершаем настройку `drupal`:
![](https://i.imgur.com/N3GzoES.png)
Настройка БД
![](https://i.imgur.com/wl9Fj2G.png)
Финальная установка
![](https://i.imgur.com/WnqYaQ7.png)

![](https://i.imgur.com/vMWGENe.png)

`phpMyAdmin` :
![](https://i.imgur.com/TKTqObg.png)

![](https://i.imgur.com/7MuuoBL.png)

![](https://i.imgur.com/zGcDnKK.png)

![](https://i.imgur.com/cgR9PEp.png)

### Ответы на вопросы:

>**Вопрос 2:** Зачем необходимо создавать для каждого сайта свою базу и своего пользователя?

1. Управление доступом и ролями, тк каждый пользователь может иметь разные индивидуальные привилегии
2. Безопасность, тк каждый сайт имеет свою собственную БД, что снижает риск утечек и доступа к данным других сайтов
3. Производительность, ведь отдельные базы данных для сайтов предотвращают их борьбу за ресурсы и в последствии медленной работе


>**Вопрос 3:** Как поменять доступ к системе управления БД на порт 1234?

![](https://i.imgur.com/1ZgGW0z.png)

нашел конфигурационный файл mariandb при м=помощи команды `find / -name`, после чего прочитал его содержимое, внизу мы видем строчку с `port`, ее и нможно поменять с 3306 на 1234

> **Вопрос 4: ** Какие преимущества, с вашей точки зрения, даёт виртуализация?

Самое объективное преимущество для меня это экономи расходов, тк меньше физических серверов = меньше расходов. С помощью виртуализации можно запускать множество поддерживаемых ОС на одном сервере. Так же виртуализация позволяет минимизировать аппаратное вмешательство

> **Вопрос 5:** Для чего необходимо устанавливать время / временную зону на сервере?**

серверы часто отслеживают события и записывают их в логи, и если время на сервере установлено неправильно, это сильно может затруднить диагностику проблем

> **Вопрос 7:** Какие есть рекомендации по разбиению диска для серверов? Почему рекомендуется так разбивать диск?

Диск рекомендуется разбивать на разделы для улучшения инфрастркутуры, организации и удобной работы с данными, к примеру:

`/ ` - раздел для самой ОС

`home` - раздел для каких-то данных пользователя

`var` - раздел для данных, которые могу в последствии изменяться (БД, временные файлы)

разделение ланных позволяет структурировать и изолировать информацию друг от друга, что значительно улучшает управляемость

## Вывод

Данная лабораторная работа позволила познакомиться с основами виртуализации и настройкой веб сервера. Я установил гипервизор Qemu и развернул на нем ОС Debian. НАстроили два веб сайта: phpmyadmin для управления бд и drupal для создания контента веб приложений. Ознакомился с файлами конфигураций и вспомнил базовый утилиты для управления данными 


